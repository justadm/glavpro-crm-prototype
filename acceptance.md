# Acceptance Criteria (Given/When/Then)

## C1 Touched
- Given нет разговоров с ЛПР
  When менеджер пытается: завести заявку / отправить КП / планировать демо / показать демо
  Then действие недоступно
- Given разговор с ЛПР зафиксирован (событие `lpr_call_done`)
  When система пересчитывает стадию
  Then следующая стадия может стать `Aware`
- Given есть разговор с ЛПР
  When менеджер открывает карточку
  Then доступна только кнопка звонка, а после отвеченного вызова — форма для комментария и дискавери

## C2 Aware
- Given есть разговор с ЛПР
  When менеджер пытается: планировать демо / показать демо
  Then действие недоступно
- Given разговор с ЛПР и заполнена дискавери (`discovery_filled`)
  When система пересчитывает стадию
  Then следующая стадия может стать `Interested`
- Given стадия Aware
  When менеджер открывает карточку
  Then доступна форма дискавери

## W1 Interested
- Given заполнена дискавери
  When менеджер пытается: завести заявку / отправить КП
  Then действие недоступно
- Given заполнена дискавери
  When менеджер планирует демо (событие `demo_scheduled` с датой/временем)
  Then следующая стадия может стать `demo_planned`
- Given стадия Interested
  When менеджер открывает карточку
  Then доступна кнопка планирования демо

## W2 demo_planned
- Given есть дата и время демо
  When менеджер пытается: завести заявку / отправить КП
  Then действие недоступно
- Given есть запланированное демо
  When зафиксирован переход по ссылке демо (`demo_done`)
  Then следующая стадия может стать `Demo_done`
- Given стадия demo_planned
  When менеджер открывает карточку
  Then доступна кнопка проведения демо по ссылке

## W3 Demo_done
- Given есть лог “демо проведено” менее 60 дней назад
  When менеджер открывает карточку
  Then доступны кнопка заведения заявки и кнопка отправки КП
- Given нет события `demo_done` или демо старше 60 дней
  When менеджер пытается завести заявку/отправить КП
  Then действия недоступны
- Given есть `invoice_issued`
  When система пересчитывает стадию
  Then следующая стадия может стать `Committed`

## H1 Committed
- Given есть счёт (`invoice_issued`)
  When система пересчитывает стадию
  Then стадия `Committed`
- Given нет оплаты
  When менеджер пытается перейти в `Customer`
  Then переход недоступен

## H2 Customer
- Given есть оплата (`payment_received`)
  When система пересчитывает стадию
  Then стадия `Customer`
- Given нет первого удостоверения
  When менеджер пытается перейти в `Activated`
  Then переход недоступен

## A1 Activated
- Given есть одно удостоверение (`first_certificate_issued`)
  When система пересчитывает стадию
  Then стадия `Activated`
